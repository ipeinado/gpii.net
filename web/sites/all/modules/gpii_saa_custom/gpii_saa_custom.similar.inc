<?php

/**
 * @file
 * This .inc file contains most of the logic for the similar products.
 */

/**
 * Render a form that supports searchable selectWoo widget.
 */
function similar_search_form() {

  // call in some custom Javascript so we can customize SelectWoo
  $path = drupal_get_path('module', 'gpii_saa_custom');
  drupal_add_js($path . '/js/similarsearch.js');

  // Some fantasy DB table which holds cities.
  $query = db_select('node', 'n');

  // Select rows that match the string.
  $return = $query
    ->fields('n', array('title', 'nid'))
    ->condition('n.title', '%' . db_like($string) . '%', 'LIKE')
    ->condition('n.status', 1)
    ->condition('n.type', 'product')
    ->orderBy('n.title', ASC)
    ->execute();

  // Add matches to $matches.
  foreach ($return as $row) {
    $match = check_plain($row->title);
    $matches[$row->nid] = html_entity_decode($match, ENT_QUOTES);
  }

  // Return for JS.
  // dpm($matches);
  $form = array();
  $form['intro'] = array(
    '#markup' => '<div id="query-filters"><p>This search method allows you to find products that are similar to a product you are already familiar with, but perhaps don\'t know about yet.</p>'
  );
  $form['product'] = array(
    '#title' => t('To get started, enter a product you are familiar with into the search box below.'),
    '#type' => 'select',
    '#options' => $matches,
    '#empty_option' => t('Type in a product name or choose from the list of product names'),
    '#multiple'     => 0,
    '#select2' => array(
      'allowClear' => TRUE,
      'closeOnSelect' => TRUE,
      //'minimumInputLength' => 1,
    ),
  );
  $form['submit'] = array(
    '#type' => 'submit',
    '#value' => 'Submit',
    '#submit' => array('similar_search_submit'),
  );
  $form['footer'] = array(
    '#markup' => '</div>'
  );
  return $form;
}

/**
 * Redirect to the specified nid.
 */
function similar_search_submit($form, &$form_state) {
  drupal_goto('search/similar/' . $form_state['values']['product']);
}

/**
 *  Similar Products Button (Custom Block)
 */
function similar_products_view() {
  $block = array();
  $markup = <<<EOD
<!-- SVG Button -->
<svg xmlns="http://www.w3.org/2000/svg" role="img" viewBox="0 0 347 103"><title>Find products similar to this one</title><defs><style>.cls-1{fill:#224196;}.cls-2,.cls-6{fill:#fff;}.cls-3{fill:#294cac;}.cls-4{fill:#e6e7e8;}.cls-5{fill:#a6a8ab;}.cls-6,.cls-7{stroke:#414042;stroke-linecap:round;stroke-linejoin:round;stroke-width:1.38px;}.cls-7{fill:none;}</style></defs><title>similar_products_button</title><g id="background"><rect id="bgrect" class="cls-1" width="347" height="103" rx="9.94"/><g id="buttontext"><path class="cls-2" d="M223.21,127.07l1.91-.33V113.3l-1.91-.33v-1.49h13.18v4.1h-2l-.19-2.28h-6.8v5.88H234V121h-6.59v5.74l1.91.33v1.47h-6.13Z" transform="translate(-99 -80)"/><path class="cls-2" d="M238.34,127.07l1.91-.33v-9.06l-1.91-.33v-1.49h4.21v10.88l1.91.33v1.47h-6.12Zm4.21-14.45h-2.3v-2.36h2.3Z" transform="translate(-99 -80)"/><path class="cls-2" d="M245.88,127.07l1.91-.33v-9.06l-1.91-.33v-1.49h4l.16,1.89a4.56,4.56,0,0,1,1.59-1.56,4.68,4.68,0,0,1,5.35.64,5.28,5.28,0,0,1,1.12,3.71v6.2l1.91.33v1.47h-6.13v-1.47l1.91-.33v-6.15a3.44,3.44,0,0,0-.66-2.38,2.64,2.64,0,0,0-2-.71,3.25,3.25,0,0,0-1.76.48,3.48,3.48,0,0,0-1.23,1.32v7.44l1.91.33v1.47h-6.13Z" transform="translate(-99 -80)"/><path class="cls-2" d="M270.09,127a4,4,0,0,1-1.51,1.31,4.58,4.58,0,0,1-2.08.45,4.34,4.34,0,0,1-3.63-1.68,7,7,0,0,1-1.31-4.43v-.24a8.49,8.49,0,0,1,1.31-4.94,4.2,4.2,0,0,1,3.65-1.87,4.65,4.65,0,0,1,2,.41,4.15,4.15,0,0,1,1.47,1.21v-5.17l-1.91-.33v-1.49h4.22v16.48l1.91.33v1.47h-3.92Zm-6.22-4.35a5.31,5.31,0,0,0,.79,3.07,2.7,2.7,0,0,0,2.42,1.16,3.09,3.09,0,0,0,1.74-.46,3.69,3.69,0,0,0,1.16-1.33v-5.88a3.74,3.74,0,0,0-1.16-1.27,3.09,3.09,0,0,0-1.71-.47,2.63,2.63,0,0,0-2.45,1.38,7,7,0,0,0-.79,3.56Z" transform="translate(-99 -80)"/><path class="cls-2" d="M281.64,131.93l1.91-.33V117.68l-1.91-.33v-1.49h3.89l.21,1.55a4.14,4.14,0,0,1,1.54-1.32,4.54,4.54,0,0,1,2.1-.46A4.2,4.2,0,0,1,293,117.5a8.37,8.37,0,0,1,1.31,4.94v.24a7,7,0,0,1-1.31,4.43,4.34,4.34,0,0,1-3.62,1.68,5.08,5.08,0,0,1-2.06-.39,4,4,0,0,1-1.5-1.17v4.37l1.91.33v1.49h-6.13ZM292,122.44a6.74,6.74,0,0,0-.84-3.55,2.74,2.74,0,0,0-2.51-1.39A3.07,3.07,0,0,0,287,118a3.24,3.24,0,0,0-1.13,1.22v6.17a3.1,3.1,0,0,0,1.13,1.22,3.23,3.23,0,0,0,1.71.42,2.83,2.83,0,0,0,2.49-1.19,5.29,5.29,0,0,0,.84-3.11Z" transform="translate(-99 -80)"/><path class="cls-2" d="M296.45,117.35v-1.49h4l.22,1.84a4.51,4.51,0,0,1,1.33-1.52,3.1,3.1,0,0,1,1.82-.55,3.56,3.56,0,0,1,.55,0l.44.09-.3,2.14-1.32-.07a2.58,2.58,0,0,0-1.53.43,2.68,2.68,0,0,0-1,1.2v7.28l1.91.33v1.47h-6.13v-1.47l1.91-.33v-9.06Z" transform="translate(-99 -80)"/><path class="cls-2" d="M306.15,122.09a7,7,0,0,1,1.53-4.64,5.63,5.63,0,0,1,8.29,0,6.94,6.94,0,0,1,1.53,4.64v.25A6.92,6.92,0,0,1,316,127a5.65,5.65,0,0,1-8.29,0,6.94,6.94,0,0,1-1.53-4.64Zm2.31.25a6,6,0,0,0,.85,3.33,2.81,2.81,0,0,0,2.53,1.31,2.78,2.78,0,0,0,2.49-1.31,6,6,0,0,0,.86-3.33v-.25a6,6,0,0,0-.86-3.32,3.06,3.06,0,0,0-5,0,6.08,6.08,0,0,0-.84,3.32Z" transform="translate(-99 -80)"/><path class="cls-2" d="M328.15,127a4,4,0,0,1-1.52,1.31,4.58,4.58,0,0,1-2.08.45,4.34,4.34,0,0,1-3.63-1.68,7,7,0,0,1-1.3-4.43v-.24a8.49,8.49,0,0,1,1.3-4.94,4.2,4.2,0,0,1,3.65-1.87,4.62,4.62,0,0,1,2,.41,4.07,4.07,0,0,1,1.47,1.21v-5.17l-1.91-.33v-1.49h4.22v16.48l1.91.33v1.47h-3.91Zm-6.22-4.35a5.39,5.39,0,0,0,.78,3.07,2.71,2.71,0,0,0,2.43,1.16,3.08,3.08,0,0,0,1.73-.46,3.6,3.6,0,0,0,1.16-1.33v-5.88a3.64,3.64,0,0,0-1.16-1.27,3.09,3.09,0,0,0-1.71-.47,2.61,2.61,0,0,0-2.44,1.38,7,7,0,0,0-.79,3.56Z" transform="translate(-99 -80)"/><path class="cls-2" d="M343.08,126.67a4.3,4.3,0,0,1-1.54,1.57,4.23,4.23,0,0,1-2.18.55,4,4,0,0,1-3.22-1.33,6.14,6.14,0,0,1-1.16-4.12v-5.66l-1.45-.33v-1.49h3.76v7.5a4.72,4.72,0,0,0,.6,2.79,2.22,2.22,0,0,0,1.86.76,3.79,3.79,0,0,0,2-.49A3.2,3.2,0,0,0,343,125v-7.32l-1.7-.33v-1.49h4v10.88l1.46.33v1.47h-3.53Z" transform="translate(-99 -80)"/><path class="cls-2" d="M354.28,127a3.1,3.1,0,0,0,2-.7,2.2,2.2,0,0,0,.88-1.74h2.07l0,.07a3.54,3.54,0,0,1-1.46,2.91,5.3,5.3,0,0,1-3.53,1.27,5.09,5.09,0,0,1-4.22-1.81,6.92,6.92,0,0,1-1.46-4.53V122a7,7,0,0,1,1.46-4.52,5.12,5.12,0,0,1,4.22-1.81,7.19,7.19,0,0,1,2.74.5,5.52,5.52,0,0,1,2,1.39l.1,2.81h-1.84l-.5-2a3.08,3.08,0,0,0-1.06-.65,4.12,4.12,0,0,0-1.45-.24,2.77,2.77,0,0,0-2.59,1.3,6.16,6.16,0,0,0-.78,3.21v.49a6.17,6.17,0,0,0,.77,3.24A2.79,2.79,0,0,0,354.28,127Z" transform="translate(-99 -80)"/><path class="cls-2" d="M365.55,112.8v3.06H368v1.71h-2.41v7.7a1.75,1.75,0,0,0,.37,1.26,1.36,1.36,0,0,0,1,.36,6,6,0,0,0,.69,0l.64-.11.31,1.58a3,3,0,0,1-1,.34,6,6,0,0,1-1.26.14,3,3,0,0,1-2.24-.85,3.68,3.68,0,0,1-.83-2.67v-7.7h-2v-1.71h2V112.8Z" transform="translate(-99 -80)"/><path class="cls-2" d="M380,119.85h-1.74l-.37-1.53a3.24,3.24,0,0,0-1.06-.63,4.12,4.12,0,0,0-1.45-.24,2.72,2.72,0,0,0-1.83.53,1.7,1.7,0,0,0-.6,1.31,1.45,1.45,0,0,0,.53,1.18,5.37,5.37,0,0,0,2.14.77,9.3,9.3,0,0,1,3.58,1.4,2.83,2.83,0,0,1,1.17,2.38,3.28,3.28,0,0,1-1.36,2.73,5.75,5.75,0,0,1-3.57,1,9.35,9.35,0,0,1-2.59-.33,7.06,7.06,0,0,1-2.05-1l0-2.9h1.74l.43,1.7a2.37,2.37,0,0,0,1.09.53,5.89,5.89,0,0,0,1.4.16,3.25,3.25,0,0,0,1.92-.49,1.6,1.6,0,0,0,.12-2.56,5.35,5.35,0,0,0-2.2-.86,9.39,9.39,0,0,1-3.48-1.37,2.77,2.77,0,0,1-1.17-2.34,3.31,3.31,0,0,1,1.32-2.64,5.19,5.19,0,0,1,3.43-1.09A8.35,8.35,0,0,1,378,116a5.4,5.4,0,0,1,1.91,1Z" transform="translate(-99 -80)"/><path class="cls-2" d="M233.12,148.65h-1.73l-.38-1.53a3.14,3.14,0,0,0-1.06-.63,4.08,4.08,0,0,0-1.45-.24,2.62,2.62,0,0,0-1.82.53,1.7,1.7,0,0,0-.6,1.3,1.44,1.44,0,0,0,.53,1.19,5.31,5.31,0,0,0,2.14.77,9.31,9.31,0,0,1,3.57,1.4,2.81,2.81,0,0,1,1.18,2.38,3.29,3.29,0,0,1-1.37,2.73,5.75,5.75,0,0,1-3.57,1,9,9,0,0,1-2.59-.34,6.9,6.9,0,0,1-2.05-1v-2.9h1.73l.44,1.7a2.43,2.43,0,0,0,1.08.53,6,6,0,0,0,1.4.16,3.28,3.28,0,0,0,1.93-.49,1.54,1.54,0,0,0,.7-1.31,1.57,1.57,0,0,0-.58-1.25,5.41,5.41,0,0,0-2.2-.86,9.25,9.25,0,0,1-3.48-1.37,2.77,2.77,0,0,1-1.17-2.34,3.31,3.31,0,0,1,1.32-2.64,5.18,5.18,0,0,1,3.42-1.09,8.31,8.31,0,0,1,2.59.37,5.23,5.23,0,0,1,1.91,1Z" transform="translate(-99 -80)"/><path class="cls-2" d="M235.65,155.87l1.91-.33v-9.06l-1.91-.33v-1.49h4.22v10.88l1.91.33v1.47h-6.13Zm4.22-14.45h-2.31v-2.36h2.31Z" transform="translate(-99 -80)"/><path class="cls-2" d="M243.08,155.87l1.91-.33v-9.06l-1.91-.33v-1.49h4l.15,1.66a4.14,4.14,0,0,1,1.57-1.4,4.79,4.79,0,0,1,2.23-.49,3.93,3.93,0,0,1,2.17.58,3.59,3.59,0,0,1,1.36,1.76,4.68,4.68,0,0,1,1.59-1.71,4.14,4.14,0,0,1,2.29-.63,3.79,3.79,0,0,1,3.07,1.33,6.08,6.08,0,0,1,1.13,4v5.78l1.91.33v1.47H258.4v-1.47l1.91-.33v-5.8a4.23,4.23,0,0,0-.65-2.66,2.33,2.33,0,0,0-1.91-.78,2.46,2.46,0,0,0-1.94.85,3.78,3.78,0,0,0-.85,2.14v6.25l1.92.33v1.47h-6.13v-1.47l1.91-.33v-5.8a4.1,4.1,0,0,0-.67-2.61,2.31,2.31,0,0,0-1.91-.83,3.21,3.21,0,0,0-1.74.44,2.77,2.77,0,0,0-1,1.22v7.58l1.91.33v1.47h-6.13Z" transform="translate(-99 -80)"/><path class="cls-2" d="M266.21,155.87l1.92-.33v-9.06l-1.92-.33v-1.49h4.22v10.88l1.91.33v1.47h-6.13Zm4.22-14.45h-2.3v-2.36h2.3Z" transform="translate(-99 -80)"/><path class="cls-2" d="M273.79,140.55v-1.49H278v16.48l1.91.33v1.47h-6.12v-1.47l1.91-.33V140.88Z" transform="translate(-99 -80)"/><path class="cls-2" d="M289.93,157.34c-.07-.34-.12-.65-.16-.92a7.84,7.84,0,0,1-.08-.82A5.63,5.63,0,0,1,288,157a4.26,4.26,0,0,1-2.14.57,4.21,4.21,0,0,1-3-1,3.53,3.53,0,0,1-1-2.72,3.17,3.17,0,0,1,1.45-2.79,7.17,7.17,0,0,1,4-1h2.38v-1.48a2.28,2.28,0,0,0-.71-1.76,2.74,2.74,0,0,0-2-.65,4.75,4.75,0,0,0-1.53.22,2.88,2.88,0,0,0-1.08.61l-.24,1.33h-1.78V146a6.8,6.8,0,0,1,2.09-1.11,8.55,8.55,0,0,1,2.68-.41,5.34,5.34,0,0,1,3.49,1.1,3.85,3.85,0,0,1,1.33,3.15v6.11c0,.16,0,.32,0,.48a3.83,3.83,0,0,0,0,.47l.94.13v1.47Zm-3.71-1.68a4.13,4.13,0,0,0,2.1-.56,3.4,3.4,0,0,0,1.36-1.32v-2.09h-2.47a3.49,3.49,0,0,0-2.24.66,2,2,0,0,0-.83,1.59,1.61,1.61,0,0,0,.52,1.28A2.36,2.36,0,0,0,286.22,155.66Z" transform="translate(-99 -80)"/><path class="cls-2" d="M294.88,146.15v-1.49h4l.22,1.84A4.51,4.51,0,0,1,300.4,145a3.1,3.1,0,0,1,1.81-.55,3.6,3.6,0,0,1,.56,0l.44.09-.3,2.14-1.32-.07a2.58,2.58,0,0,0-1.53.43,2.68,2.68,0,0,0-1,1.2v7.28l1.91.33v1.47h-6.13v-1.47l1.91-.33v-9.06Z" transform="translate(-99 -80)"/><path class="cls-2" d="M314.8,141.6v3.06h2.4v1.71h-2.4v7.7a1.73,1.73,0,0,0,.37,1.26,1.35,1.35,0,0,0,1,.36,5.89,5.89,0,0,0,.68-.05c.26,0,.47-.07.64-.11l.32,1.58a3,3,0,0,1-1,.34,6.1,6.1,0,0,1-1.27.14,3,3,0,0,1-2.24-.85,3.73,3.73,0,0,1-.83-2.67v-7.7h-2v-1.71h2V141.6Z" transform="translate(-99 -80)"/><path class="cls-2" d="M319.34,150.89a7,7,0,0,1,1.52-4.64,5.63,5.63,0,0,1,8.29,0,6.94,6.94,0,0,1,1.53,4.64v.25a7,7,0,0,1-1.52,4.64,5.66,5.66,0,0,1-8.3,0,6.93,6.93,0,0,1-1.52-4.64Zm2.3.25a6,6,0,0,0,.85,3.33,3.07,3.07,0,0,0,5,0,6,6,0,0,0,.85-3.33v-.25a6,6,0,0,0-.85-3.32,3.06,3.06,0,0,0-5,0,6.08,6.08,0,0,0-.85,3.32Z" transform="translate(-99 -80)"/><path class="cls-2" d="M342.79,141.6v3.06h2.4v1.71h-2.4v7.7a1.77,1.77,0,0,0,.36,1.26,1.36,1.36,0,0,0,1,.36,6,6,0,0,0,.69-.05c.25,0,.47-.07.64-.11l.31,1.58a3,3,0,0,1-1,.34,6,6,0,0,1-1.26.14,3,3,0,0,1-2.24-.85,3.68,3.68,0,0,1-.83-2.67v-7.7h-2v-1.71h2V141.6Z" transform="translate(-99 -80)"/><path class="cls-2" d="M347.23,155.87l1.91-.33V140.88l-1.91-.33v-1.49h4.22v7.29a4.62,4.62,0,0,1,1.6-1.42,4.5,4.5,0,0,1,2.11-.5,4.06,4.06,0,0,1,3.16,1.22,5.37,5.37,0,0,1,1.13,3.75v6.14l1.91.33v1.47h-6.13v-1.47l1.91-.33v-6.17a3.4,3.4,0,0,0-.67-2.32,2.57,2.57,0,0,0-2-.75,3.38,3.38,0,0,0-1.73.45,3.76,3.76,0,0,0-1.28,1.23v7.56l1.91.33v1.47h-6.13Z" transform="translate(-99 -80)"/><path class="cls-2" d="M363,155.87l1.91-.33v-9.06l-1.91-.33v-1.49h4.21v10.88l1.91.33v1.47H363Zm4.21-14.45H365v-2.36h2.3Z" transform="translate(-99 -80)"/><path class="cls-2" d="M380.63,148.65h-1.74l-.37-1.53a3.35,3.35,0,0,0-1.06-.63,4.12,4.12,0,0,0-1.45-.24,2.67,2.67,0,0,0-1.83.53,1.7,1.7,0,0,0-.6,1.3,1.47,1.47,0,0,0,.53,1.19,5.37,5.37,0,0,0,2.14.77,9.3,9.3,0,0,1,3.58,1.4,2.83,2.83,0,0,1,1.17,2.38,3.29,3.29,0,0,1-1.37,2.73,5.72,5.72,0,0,1-3.56,1,9,9,0,0,1-2.59-.34,6.79,6.79,0,0,1-2.05-1l0-2.9h1.74l.43,1.7a2.47,2.47,0,0,0,1.09.53,5.89,5.89,0,0,0,1.4.16,3.25,3.25,0,0,0,1.92-.49,1.6,1.6,0,0,0,.12-2.56,5.41,5.41,0,0,0-2.2-.86,9.32,9.32,0,0,1-3.48-1.37,2.77,2.77,0,0,1-1.17-2.34,3.31,3.31,0,0,1,1.32-2.64,5.19,5.19,0,0,1,3.43-1.09,8.35,8.35,0,0,1,2.59.37,5.4,5.4,0,0,1,1.91,1Z" transform="translate(-99 -80)"/><path class="cls-2" d="M389.13,150.89a7,7,0,0,1,1.53-4.64,5.63,5.63,0,0,1,8.29,0,6.94,6.94,0,0,1,1.53,4.64v.25a6.92,6.92,0,0,1-1.53,4.64,5.65,5.65,0,0,1-8.29,0,6.94,6.94,0,0,1-1.53-4.64Zm2.31.25a6,6,0,0,0,.85,3.33,2.81,2.81,0,0,0,2.53,1.31,2.78,2.78,0,0,0,2.49-1.31,6,6,0,0,0,.86-3.33v-.25a6,6,0,0,0-.86-3.32,2.81,2.81,0,0,0-2.52-1.32,2.77,2.77,0,0,0-2.5,1.32,6,6,0,0,0-.85,3.32Z" transform="translate(-99 -80)"/><path class="cls-2" d="M402.25,155.87l1.91-.33v-9.06l-1.91-.33v-1.49h4l.16,1.89A4.56,4.56,0,0,1,408,145a4.68,4.68,0,0,1,5.35.64,5.28,5.28,0,0,1,1.13,3.71v6.2l1.91.33v1.47h-6.13v-1.47l1.91-.33v-6.15a3.39,3.39,0,0,0-.67-2.38,2.64,2.64,0,0,0-2-.71,3.25,3.25,0,0,0-1.76.48,3.56,3.56,0,0,0-1.23,1.32v7.44l1.92.33v1.47h-6.13Z" transform="translate(-99 -80)"/><path class="cls-2" d="M423.7,157.59a5.36,5.36,0,0,1-4.21-1.76,6.68,6.68,0,0,1-1.56-4.58v-.52a6.47,6.47,0,0,1,1.61-4.5,5,5,0,0,1,3.81-1.8,4.77,4.77,0,0,1,3.87,1.55,6.12,6.12,0,0,1,1.32,4.12v1.44h-8.22l0,.06a5,5,0,0,0,.93,3,2.94,2.94,0,0,0,2.49,1.17,5.9,5.9,0,0,0,2.06-.33,4.7,4.7,0,0,0,1.53-.92l.9,1.5a5.42,5.42,0,0,1-1.8,1.11A7.18,7.18,0,0,1,423.7,157.59Zm-.35-11.34a2.51,2.51,0,0,0-2,1,4.68,4.68,0,0,0-1,2.46l0,.06h5.84v-.31a3.56,3.56,0,0,0-.72-2.27A2.6,2.6,0,0,0,423.35,146.25Z" transform="translate(-99 -80)"/></g></g><g id="circle"><circle class="cls-3" cx="61.22" cy="51.96" r="47.22"/></g><g id="icon"><path class="cls-2" d="M165.91,128.9l.44,5-2-1.62-10.12,5.05-1.66-4.43,7.75-3.87-2-1.62Z" transform="translate(-99 -80)"/><polygon class="cls-4" points="59.18 27.5 59.18 44.02 76.48 52.99 76.48 36.53 59.18 27.5"/><polygon class="cls-5" points="93.78 27.5 93.78 44.02 76.48 52.99 76.48 36.53 93.78 27.5"/><polygon class="cls-6" points="76.48 36.53 93.78 27.56 76.48 19.87 59.18 27.56 76.48 36.53"/><line class="cls-7" x1="76.48" y1="36.53" x2="76.48" y2="52.99"/><polyline class="cls-7" points="76.48 52.99 59.18 44.02 59.18 27.56"/><polyline class="cls-7" points="93.78 27.56 93.78 44.02 76.48 52.99"/><polygon class="cls-4" points="62.64 64.74 62.64 80.16 76.48 87.34 76.48 71.96 62.64 64.74"/><polygon class="cls-5" points="90.32 64.74 90.32 80.16 76.48 87.34 76.48 71.96 90.32 64.74"/><polygon class="cls-6" points="76.48 71.96 90.32 64.79 76.48 58.64 62.64 64.79 76.48 71.96"/><line class="cls-7" x1="76.48" y1="71.96" x2="76.48" y2="87.34"/><polyline class="cls-7" points="76.48 87.34 62.64 80.16 62.64 64.79"/><polyline class="cls-7" points="90.32 64.79 90.32 80.16 76.48 87.34"/><polygon class="cls-5" points="55.31 44.06 55.31 62.05 38.95 70.42 38.95 52.48 55.31 44.06"/><polygon class="cls-4" points="21.03 43.36 21.03 62.63 38.32 71.6 38.32 52.38 21.03 43.36"/><line class="cls-7" x1="38.32" y1="52.38" x2="38.32" y2="71.6"/><polyline class="cls-7" points="38.32 71.6 21.03 62.63 21.03 43.42"/><polyline class="cls-7" points="55.62 43.42 55.62 62.63 38.32 71.6"/><polygon class="cls-6" points="38.32 52.38 55.62 43.42 38.32 35.73 21.03 43.42 38.32 52.38"/><polygon class="cls-4" points="38.32 36.43 38.32 51.55 54.16 43.64 38.32 36.43"/><polygon class="cls-4" points="76.48 20.64 76.48 35.76 92.31 27.56 76.48 20.64"/><polygon class="cls-4" points="76.48 59.45 76.48 71.03 88.63 64.79 76.48 59.45"/><path class="cls-2" d="M150.92,155.5l2.38-1.75L144.05,149l5.08-2.65,8.93,4.61,2.39-1.75-.75,5.58Z" transform="translate(-99 -80)"/></g></svg>
EOD;

  // Block output in HTML with div wrapper.
  $block = array(
    '#prefix' => '<div class="similar-products-wrap">',
    '#type' => 'markup',
    '#markup' => '<a href="/search/similar/' . arg(1) . '" title="Search for products similar to this one">' . $markup . '</a>',
    '#suffix' => '</div>',
  );

  return $block;
}